{
    "sourceFile": "src/pages/ResetPassword.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1764775760322,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764776076239,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,9 +5,11 @@\n import { toast } from \"@/hooks/use-toast\";\r\n import { useNavigate, useSearchParams } from \"react-router-dom\";\r\n import { passwordSchema } from \"@/lib/validation\";\r\n import { useAuth } from \"@/contexts/AuthContext\";\r\n+import { useAuth } from \"@/contexts/AuthContext\";\r\n \r\n+\r\n const ResetPassword = () => {\r\n   const [search] = useSearchParams();\r\n   const email = search.get(\"email\") || \"\";\r\n \r\n"
                },
                {
                    "date": 1764776101649,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,9 +5,8 @@\n import { toast } from \"@/hooks/use-toast\";\r\n import { useNavigate, useSearchParams } from \"react-router-dom\";\r\n import { passwordSchema } from \"@/lib/validation\";\r\n import { useAuth } from \"@/contexts/AuthContext\";\r\n-import { useAuth } from \"@/contexts/AuthContext\";\r\n \r\n \r\n const ResetPassword = () => {\r\n   const [search] = useSearchParams();\r\n@@ -18,46 +17,53 @@\n \r\n   const { verifyOtpLogin } = useAuth();\r\n   const navigate = useNavigate();\r\n \r\n-  const handleSubmit = async (e: React.FormEvent) => {\r\n-    e.preventDefault();\r\n+ const handleSubmit = async (e: React.FormEvent) => {\r\n+  e.preventDefault();\r\n \r\n-    const v = passwordSchema.safeParse(password);\r\n-    if (!v.success) {\r\n-      toast({\r\n-        title: \"Weak password\",\r\n-        description: v.error.issues[0].message,\r\n-        variant: \"destructive\",\r\n-      });\r\n-      return;\r\n-    }\r\n+  const v = passwordSchema.safeParse(password);\r\n+  if (!v.success) {\r\n+    toast({\r\n+      title: \"Weak password\",\r\n+      description: v.error.issues[0].message,\r\n+      variant: \"destructive\",\r\n+    });\r\n+    return;\r\n+  }\r\n \r\n-    if (password !== confirm) {\r\n-      toast({\r\n-        title: \"Passwords do not match\",\r\n-        variant: \"destructive\",\r\n-      });\r\n-      return;\r\n-    }\r\n+  if (password !== confirm) {\r\n+    toast({\r\n+      title: \"Passwords do not match\",\r\n+      variant: \"destructive\",\r\n+    });\r\n+    return;\r\n+  }\r\n \r\n-    try {\r\n-      const data = await resetPassword(email, password);\r\n+  try {\r\n+    // reset password on backend\r\n+    const data = await resetPassword(email, password);\r\n \r\n-      // Auto login & redirect\r\n-      localStorage.setItem(\"carfinder_user\", JSON.stringify(data.user));\r\n-      toast({ title: \"Password reset!\", description: \"Logging you in...\" });\r\n+    // ⬇️ AUTO LOGIN using AuthContext — THE FIX\r\n+    saveUserSession(data);\r\n \r\n-      navigate(\"/\");\r\n-    } catch (error) {\r\n-      toast({\r\n-        title: \"Failed to reset password\",\r\n-        description: (error as Error).message,\r\n-        variant: \"destructive\",\r\n-      });\r\n-    }\r\n-  };\r\n+    toast({\r\n+      title: \"Password reset!\",\r\n+      description: \"Logging you in...\",\r\n+    });\r\n \r\n+    navigate(\"/\"); // redirect to dashboard\r\n+\r\n+  } catch (error) {\r\n+    toast({\r\n+      title: \"Failed to reset password\",\r\n+      description: (error as Error).message,\r\n+      variant: \"destructive\",\r\n+    });\r\n+  }\r\n+};\r\n+\r\n+\r\n   return (\r\n     <div className=\"flex min-h-screen items-center justify-center\">\r\n       <form className=\"space-y-4 w-full max-w-sm\" onSubmit={handleSubmit}>\r\n         <h1 className=\"text-xl font-semibold\">Create new password</h1>\r\n"
                },
                {
                    "date": 1764776510940,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,68 +6,69 @@\n import { useNavigate, useSearchParams } from \"react-router-dom\";\r\n import { passwordSchema } from \"@/lib/validation\";\r\n import { useAuth } from \"@/contexts/AuthContext\";\r\n \r\n-\r\n const ResetPassword = () => {\r\n   const [search] = useSearchParams();\r\n   const email = search.get(\"email\") || \"\";\r\n \r\n   const [password, setPassword] = useState(\"\");\r\n   const [confirm, setConfirm] = useState(\"\");\r\n \r\n-  const { verifyOtpLogin } = useAuth();\r\n+  // ⭐ ADD THIS — allows us to auto-login\r\n+  const { saveUserSession } = useAuth();\r\n+\r\n   const navigate = useNavigate();\r\n \r\n- const handleSubmit = async (e: React.FormEvent) => {\r\n-  e.preventDefault();\r\n+  const handleSubmit = async (e: React.FormEvent) => {\r\n+    e.preventDefault();\r\n \r\n-  const v = passwordSchema.safeParse(password);\r\n-  if (!v.success) {\r\n-    toast({\r\n-      title: \"Weak password\",\r\n-      description: v.error.issues[0].message,\r\n-      variant: \"destructive\",\r\n-    });\r\n-    return;\r\n-  }\r\n+    // Validate password\r\n+    const v = passwordSchema.safeParse(password);\r\n+    if (!v.success) {\r\n+      toast({\r\n+        title: \"Weak password\",\r\n+        description: v.error.issues[0].message,\r\n+        variant: \"destructive\",\r\n+      });\r\n+      return;\r\n+    }\r\n \r\n-  if (password !== confirm) {\r\n-    toast({\r\n-      title: \"Passwords do not match\",\r\n-      variant: \"destructive\",\r\n-    });\r\n-    return;\r\n-  }\r\n+    if (password !== confirm) {\r\n+      toast({\r\n+        title: \"Passwords do not match\",\r\n+        variant: \"destructive\",\r\n+      });\r\n+      return;\r\n+    }\r\n \r\n-  try {\r\n-    // reset password on backend\r\n-    const data = await resetPassword(email, password);\r\n+    try {\r\n+      // Backend updates password + returns user & token\r\n+      const data = await resetPassword(email, password);\r\n \r\n-    // ⬇️ AUTO LOGIN using AuthContext — THE FIX\r\n-    saveUserSession(data);\r\n+      // ⭐ Auto-login immediately\r\n+      saveUserSession(data);\r\n \r\n-    toast({\r\n-      title: \"Password reset!\",\r\n-      description: \"Logging you in...\",\r\n-    });\r\n+      toast({\r\n+        title: \"Password reset!\",\r\n+        description: \"Logging you in...\",\r\n+      });\r\n \r\n-    navigate(\"/\"); // redirect to dashboard\r\n+      navigate(\"/\"); // Dashboard\r\n \r\n-  } catch (error) {\r\n-    toast({\r\n-      title: \"Failed to reset password\",\r\n-      description: (error as Error).message,\r\n-      variant: \"destructive\",\r\n-    });\r\n-  }\r\n-};\r\n+    } catch (error) {\r\n+      toast({\r\n+        title: \"Failed to reset password\",\r\n+        description: (error as Error).message,\r\n+        variant: \"destructive\",\r\n+      });\r\n+    }\r\n+  };\r\n \r\n-\r\n   return (\r\n     <div className=\"flex min-h-screen items-center justify-center\">\r\n       <form className=\"space-y-4 w-full max-w-sm\" onSubmit={handleSubmit}>\r\n-        <h1 className=\"text-xl font-semibold\">Create new password</h1>\r\n+        <h1 className=\"text-xl font-semibold\">Create New Password</h1>\r\n \r\n         <Input\r\n           className=\"h-8 text-sm\"\r\n           placeholder=\"New password\"\r\n@@ -85,9 +86,11 @@\n           onChange={(e) => setConfirm(e.target.value)}\r\n           required\r\n         />\r\n \r\n-        <Button className=\"w-full h-9 text-sm\">Reset Password</Button>\r\n+        <Button className=\"w-full h-9 text-sm\">\r\n+          Reset Password\r\n+        </Button>\r\n       </form>\r\n     </div>\r\n   );\r\n };\r\n"
                }
            ],
            "date": 1764775760322,
            "name": "Commit-0",
            "content": "import { useState } from \"react\";\r\nimport { resetPassword } from \"@/api/auth\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { toast } from \"@/hooks/use-toast\";\r\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\r\nimport { passwordSchema } from \"@/lib/validation\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\n\r\nconst ResetPassword = () => {\r\n  const [search] = useSearchParams();\r\n  const email = search.get(\"email\") || \"\";\r\n\r\n  const [password, setPassword] = useState(\"\");\r\n  const [confirm, setConfirm] = useState(\"\");\r\n\r\n  const { verifyOtpLogin } = useAuth();\r\n  const navigate = useNavigate();\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    const v = passwordSchema.safeParse(password);\r\n    if (!v.success) {\r\n      toast({\r\n        title: \"Weak password\",\r\n        description: v.error.issues[0].message,\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (password !== confirm) {\r\n      toast({\r\n        title: \"Passwords do not match\",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const data = await resetPassword(email, password);\r\n\r\n      // Auto login & redirect\r\n      localStorage.setItem(\"carfinder_user\", JSON.stringify(data.user));\r\n      toast({ title: \"Password reset!\", description: \"Logging you in...\" });\r\n\r\n      navigate(\"/\");\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Failed to reset password\",\r\n        description: (error as Error).message,\r\n        variant: \"destructive\",\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex min-h-screen items-center justify-center\">\r\n      <form className=\"space-y-4 w-full max-w-sm\" onSubmit={handleSubmit}>\r\n        <h1 className=\"text-xl font-semibold\">Create new password</h1>\r\n\r\n        <Input\r\n          className=\"h-8 text-sm\"\r\n          placeholder=\"New password\"\r\n          type=\"password\"\r\n          value={password}\r\n          onChange={(e) => setPassword(e.target.value)}\r\n          required\r\n        />\r\n\r\n        <Input\r\n          className=\"h-8 text-sm\"\r\n          placeholder=\"Confirm password\"\r\n          type=\"password\"\r\n          value={confirm}\r\n          onChange={(e) => setConfirm(e.target.value)}\r\n          required\r\n        />\r\n\r\n        <Button className=\"w-full h-9 text-sm\">Reset Password</Button>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ResetPassword;\r\n"
        }
    ]
}