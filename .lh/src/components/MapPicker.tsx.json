{
    "sourceFile": "src/components/MapPicker.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1759939479943,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1759939479943,
            "name": "Commit-0",
            "content": "import { useEffect, useRef, useState } from \"react\";\r\nimport mapboxgl from \"mapbox-gl\";\r\nimport \"mapbox-gl/dist/mapbox-gl.css\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { MapPin } from \"lucide-react\";\r\n\r\ninterface MapPickerProps {\r\n  onLocationSelect: (lat: number, lng: number, address: string) => void;\r\n  initialLat?: number;\r\n  initialLng?: number;\r\n}\r\n\r\nconst MapPicker = ({ onLocationSelect, initialLat = 37.7749, initialLng = -122.4194 }: MapPickerProps) => {\r\n  const mapContainer = useRef<HTMLDivElement>(null);\r\n  const map = useRef<mapboxgl.Map | null>(null);\r\n  const marker = useRef<mapboxgl.Marker | null>(null);\r\n  const [mapboxToken, setMapboxToken] = useState(localStorage.getItem(\"mapbox_token\") || \"\");\r\n  const [needsToken, setNeedsToken] = useState(!localStorage.getItem(\"mapbox_token\"));\r\n\r\n  useEffect(() => {\r\n    if (!mapContainer.current || !mapboxToken) return;\r\n\r\n    try {\r\n      mapboxgl.accessToken = mapboxToken;\r\n      localStorage.setItem(\"mapbox_token\", mapboxToken);\r\n\r\n      map.current = new mapboxgl.Map({\r\n        container: mapContainer.current,\r\n        style: \"mapbox://styles/mapbox/streets-v12\",\r\n        center: [initialLng, initialLat],\r\n        zoom: 12,\r\n      });\r\n\r\n      map.current.addControl(new mapboxgl.NavigationControl(), \"top-right\");\r\n\r\n      // Add initial marker\r\n      marker.current = new mapboxgl.Marker({ draggable: true })\r\n        .setLngLat([initialLng, initialLat])\r\n        .addTo(map.current);\r\n\r\n      // Handle marker drag\r\n      marker.current.on(\"dragend\", () => {\r\n        if (marker.current) {\r\n          const lngLat = marker.current.getLngLat();\r\n          onLocationSelect(lngLat.lat, lngLat.lng, `${lngLat.lat.toFixed(4)}, ${lngLat.lng.toFixed(4)}`);\r\n        }\r\n      });\r\n\r\n      // Handle map click\r\n      map.current.on(\"click\", (e) => {\r\n        if (marker.current && map.current) {\r\n          marker.current.setLngLat(e.lngLat);\r\n          onLocationSelect(e.lngLat.lat, e.lngLat.lng, `${e.lngLat.lat.toFixed(4)}, ${e.lngLat.lng.toFixed(4)}`);\r\n        }\r\n      });\r\n\r\n      setNeedsToken(false);\r\n    } catch (error) {\r\n      console.error(\"Map initialization error:\", error);\r\n    }\r\n\r\n    return () => {\r\n      map.current?.remove();\r\n    };\r\n  }, [mapboxToken, initialLat, initialLng, onLocationSelect]);\r\n\r\n  if (needsToken) {\r\n    return (\r\n      <div className=\"space-y-3 rounded-lg border border-dashed bg-muted/30 p-6\">\r\n        <div className=\"flex items-center gap-2 text-muted-foreground\">\r\n          <MapPin className=\"h-5 w-5\" />\r\n          <p className=\"text-sm font-medium\">Map Location Picker</p>\r\n        </div>\r\n        <p className=\"text-sm text-muted-foreground\">\r\n          To use the interactive map, please enter your Mapbox token. Get one free at{\" \"}\r\n          <a href=\"https://mapbox.com\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-primary hover:underline\">\r\n            mapbox.com\r\n          </a>\r\n        </p>\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"mapbox-token\">Mapbox Token</Label>\r\n          <Input\r\n            id=\"mapbox-token\"\r\n            type=\"text\"\r\n            placeholder=\"pk.ey...\"\r\n            value={mapboxToken}\r\n            onChange={(e) => setMapboxToken(e.target.value)}\r\n          />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-2\">\r\n      <p className=\"text-sm text-muted-foreground\">Click on the map or drag the marker to select your car's location</p>\r\n      <div ref={mapContainer} className=\"h-[400px] w-full rounded-lg border shadow-sm\" />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MapPicker;"
        }
    ]
}