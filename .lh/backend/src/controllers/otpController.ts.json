{
    "sourceFile": "backend/src/controllers/otpController.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1762459199598,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1762459199598,
            "name": "Commit-0",
            "content": "import { Request, Response } from \"express\";\r\nimport nodemailer from \"nodemailer\";\r\nimport crypto from \"crypto\";\r\nimport { Otp } from \"../models/Otp\";\r\n\r\nexport const sendOtp = async (req: Request, res: Response) => {\r\n  const { email } = req.body;\r\n\r\n  if (!email) return res.status(400).json({ message: \"Email is required\" });\r\n\r\n  const otpCode = crypto.randomInt(100000, 999999).toString();\r\n\r\n  // Save OTP in DB\r\n  await Otp.create({ email, otp: otpCode });\r\n\r\n  // Send OTP by email\r\n  const transporter = nodemailer.createTransport({\r\n    service: \"gmail\",\r\n    auth: {\r\n      user: process.env.EMAIL_USER, // e.g. your Gmail\r\n      pass: process.env.EMAIL_PASS, // app password\r\n    },\r\n  });\r\n\r\n  await transporter.sendMail({\r\n    from: `\"CarFinder OTP\" <${process.env.EMAIL_USER}>`,\r\n    to: email,\r\n    subject: \"Your OTP Code\",\r\n    text: `Your verification code is ${otpCode}. It will expire in 5 minutes.`,\r\n  });\r\n\r\n  res.json({ message: \"OTP sent successfully!\" });\r\n};\r\n\r\nexport const verifyOtp = async (req: Request, res: Response) => {\r\n  const { email, otp } = req.body;\r\n\r\n  const record = await Otp.findOne({ email, otp });\r\n  if (!record) return res.status(400).json({ message: \"Invalid or expired OTP\" });\r\n\r\n  await Otp.deleteMany({ email }); // clear OTPs after verification\r\n\r\n  res.json({ message: \"OTP verified successfully!\" });\r\n};\r\n"
        }
    ]
}