{
    "sourceFile": "backend/src/config/passport.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 22,
            "patches": [
                {
                    "date": 1762458197787,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1762458317314,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,17 +2,22 @@\n import { Strategy as GoogleStrategy } from \"passport-google-oauth20\";\r\n import { Strategy as FacebookStrategy } from \"passport-facebook\";\r\n import { User } from \"../models/User\";\r\n \r\n-passport.serializeUser((user: any, done) => {\r\n-  done(null, user.id);\r\n+interface SerializedUser {\r\n+  id: string;\r\n+}\r\n+\r\n+// Serialize the user ID into the session\r\n+passport.serializeUser((user: Express.User | SerializedUser, done) => {\r\n+  done(null, (user as SerializedUser).id);\r\n });\r\n \r\n-passport.deserializeUser(async (id, done) => {\r\n-  const user = await User.findById(id);\r\n-  done(null, user);\r\n+// Deserialize the user ID from the session\r\n+passport.deserializeUser((id: string, done) => {\r\n+  // Here you‚Äôd fetch the user from the database\r\n+  done(null, { id });\r\n });\r\n-\r\n // ‚úÖ Google Strategy\r\n passport.use(\r\n   new GoogleStrategy(\r\n     {\r\n"
                },
                {
                    "date": 1762459163889,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,64 @@\n+import passport from \"passport\";\r\n+import { Strategy as GoogleStrategy } from \"passport-google-oauth20\";\r\n+import { Strategy as FacebookStrategy } from \"passport-facebook\";\r\n+import { User } from \"../models/User\";\r\n+\r\n+interface SerializedUser {\r\n+  id: string;\r\n+}\r\n+\r\n+// Serialize the user ID into the session\r\n+passport.serializeUser((user: Express.User | SerializedUser, done) => {\r\n+  done(null, (user as SerializedUser).id);\r\n+});\r\n+\r\n+// Deserialize the user ID from the session\r\n+passport.deserializeUser((id: string, done) => {\r\n+  // Here you‚Äôd fetch the user from the database\r\n+  done(null, { id });\r\n+});\r\n+// ‚úÖ Google Strategy\r\n+passport.use(\r\n+  new GoogleStrategy(\r\n+    {\r\n+      clientID: process.env.GOOGLE_CLIENT_ID!,\r\n+      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\r\n+      callbackURL: \"http://localhost:5000/api/auth/google/callback\",\r\n+    },\r\n+    async (_accessToken, _refreshToken, profile, done) => {\r\n+      let user = await User.findOne({ email: profile.emails?.[0].value });\r\n+      if (!user) {\r\n+        user = await User.create({\r\n+          name: profile.displayName,\r\n+          email: profile.emails?.[0].value,\r\n+          password: \"google_oauth\",\r\n+        });\r\n+      }\r\n+      return done(null, user);\r\n+    }\r\n+  )\r\n+);\r\n+\r\n+// ‚úÖ Facebook Strategy\r\n+passport.use(\r\n+  new FacebookStrategy(\r\n+    {\r\n+      clientID: process.env.FACEBOOK_APP_ID!,\r\n+      clientSecret: process.env.FACEBOOK_APP_SECRET!,\r\n+      callbackURL: \"http://localhost:5000/api/auth/facebook/callback\",\r\n+      profileFields: [\"id\", \"emails\", \"name\"],\r\n+    },\r\n+    async (_accessToken, _refreshToken, profile, done) => {\r\n+      let email = profile.emails?.[0].value;\r\n+      let user = await User.findOne({ email });\r\n+      if (!user) {\r\n+        user = await User.create({\r\n+          name: `${profile.name?.givenName} ${profile.name?.familyName}`,\r\n+          email,\r\n+          password: \"facebook_oauth\",\r\n+        });\r\n+      }\r\n+      return done(null, user);\r\n+    }\r\n+  )\r\n+);\r\n"
                },
                {
                    "date": 1762460834260,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,4 +1,7 @@\n+import dotenv from \"dotenv\";\r\n+dotenv.config(); // ‚úÖ Must be at the top\r\n+\r\n import passport from \"passport\";\r\n import { Strategy as GoogleStrategy } from \"passport-google-oauth20\";\r\n import { Strategy as FacebookStrategy } from \"passport-facebook\";\r\n import { User } from \"../models/User\";\r\n@@ -6,123 +9,81 @@\n interface SerializedUser {\r\n   id: string;\r\n }\r\n \r\n-// Serialize the user ID into the session\r\n-passport.serializeUser((user: Express.User | SerializedUser, done) => {\r\n-  done(null, (user as SerializedUser).id);\r\n+// ‚úÖ Serialize user\r\n+passport.serializeUser((user: any, done) => {\r\n+  done(null, user.id);\r\n });\r\n \r\n-// Deserialize the user ID from the session\r\n+// ‚úÖ Deserialize user\r\n passport.deserializeUser((id: string, done) => {\r\n-  // Here you‚Äôd fetch the user from the database\r\n   done(null, { id });\r\n });\r\n+\r\n+// üß© Debug print (check env loading)\r\n+console.log(\"üîç Google OAuth ENV:\", {\r\n+  id: process.env.GOOGLE_CLIENT_ID,\r\n+  secret: process.env.GOOGLE_CLIENT_SECRET ? \"‚úÖ Loaded\" : \"‚ùå Missing\",\r\n+  callback: process.env.GOOGLE_CALLBACK_URL,\r\n+});\r\n+\r\n // ‚úÖ Google Strategy\r\n passport.use(\r\n   new GoogleStrategy(\r\n     {\r\n-      clientID: process.env.GOOGLE_CLIENT_ID!,\r\n-      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\r\n-      callbackURL: \"http://localhost:5000/api/auth/google/callback\",\r\n+      clientID: process.env.GOOGLE_CLIENT_ID || \"\",\r\n+      clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"\",\r\n+      callbackURL: process.env.GOOGLE_CALLBACK_URL || \"\",\r\n     },\r\n     async (_accessToken, _refreshToken, profile, done) => {\r\n-      let user = await User.findOne({ email: profile.emails?.[0].value });\r\n-      if (!user) {\r\n-        user = await User.create({\r\n-          name: profile.displayName,\r\n-          email: profile.emails?.[0].value,\r\n-          password: \"google_oauth\",\r\n-        });\r\n+      try {\r\n+        const email = profile.emails?.[0].value;\r\n+        let user = await User.findOne({ email });\r\n+\r\n+        if (!user) {\r\n+          user = await User.create({\r\n+            name: profile.displayName,\r\n+            email,\r\n+            password: \"google_oauth\",\r\n+          });\r\n+        }\r\n+\r\n+        return done(null, user);\r\n+      } catch (err) {\r\n+        return done(err, null);\r\n       }\r\n-      return done(null, user);\r\n     }\r\n   )\r\n );\r\n \r\n-// ‚úÖ Facebook Strategy\r\n+// ‚úÖ Facebook Strategy (optional)\r\n passport.use(\r\n   new FacebookStrategy(\r\n     {\r\n-      clientID: process.env.FACEBOOK_APP_ID!,\r\n-      clientSecret: process.env.FACEBOOK_APP_SECRET!,\r\n+      clientID: process.env.FACEBOOK_APP_ID || \"\",\r\n+      clientSecret: process.env.FACEBOOK_APP_SECRET || \"\",\r\n       callbackURL: \"http://localhost:5000/api/auth/facebook/callback\",\r\n       profileFields: [\"id\", \"emails\", \"name\"],\r\n     },\r\n     async (_accessToken, _refreshToken, profile, done) => {\r\n-      let email = profile.emails?.[0].value;\r\n-      let user = await User.findOne({ email });\r\n-      if (!user) {\r\n-        user = await User.create({\r\n-          name: `${profile.name?.givenName} ${profile.name?.familyName}`,\r\n-          email,\r\n-          password: \"facebook_oauth\",\r\n-        });\r\n-      }\r\n-      return done(null, user);\r\n-    }\r\n-  )\r\n-);\r\n-import passport from \"passport\";\r\n-import { Strategy as GoogleStrategy } from \"passport-google-oauth20\";\r\n-import { Strategy as FacebookStrategy } from \"passport-facebook\";\r\n-import { User } from \"../models/User\";\r\n+      try {\r\n+        const email = profile.emails?.[0].value;\r\n+        let user = await User.findOne({ email });\r\n \r\n-interface SerializedUser {\r\n-  id: string;\r\n-}\r\n+        if (!user) {\r\n+          user = await User.create({\r\n+            name: `${profile.name?.givenName} ${profile.name?.familyName}`,\r\n+            email,\r\n+            password: \"facebook_oauth\",\r\n+          });\r\n+        }\r\n \r\n-// Serialize the user ID into the session\r\n-passport.serializeUser((user: Express.User | SerializedUser, done) => {\r\n-  done(null, (user as SerializedUser).id);\r\n-});\r\n-\r\n-// Deserialize the user ID from the session\r\n-passport.deserializeUser((id: string, done) => {\r\n-  // Here you‚Äôd fetch the user from the database\r\n-  done(null, { id });\r\n-});\r\n-// ‚úÖ Google Strategy\r\n-passport.use(\r\n-  new GoogleStrategy(\r\n-    {\r\n-      clientID: process.env.GOOGLE_CLIENT_ID!,\r\n-      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\r\n-      callbackURL: \"http://localhost:5000/api/auth/google/callback\",\r\n-    },\r\n-    async (_accessToken, _refreshToken, profile, done) => {\r\n-      let user = await User.findOne({ email: profile.emails?.[0].value });\r\n-      if (!user) {\r\n-        user = await User.create({\r\n-          name: profile.displayName,\r\n-          email: profile.emails?.[0].value,\r\n-          password: \"google_oauth\",\r\n-        });\r\n+        return done(null, user);\r\n+      } catch (err) {\r\n+        return done(err, null);\r\n       }\r\n-      return done(null, user);\r\n     }\r\n   )\r\n );\r\n \r\n-// ‚úÖ Facebook Strategy\r\n-passport.use(\r\n-  new FacebookStrategy(\r\n-    {\r\n-      clientID: process.env.FACEBOOK_APP_ID!,\r\n-      clientSecret: process.env.FACEBOOK_APP_SECRET!,\r\n-      callbackURL: \"http://localhost:5000/api/auth/facebook/callback\",\r\n-      profileFields: [\"id\", \"emails\", \"name\"],\r\n-    },\r\n-    async (_accessToken, _refreshToken, profile, done) => {\r\n-      let email = profile.emails?.[0].value;\r\n-      let user = await User.findOne({ email });\r\n-      if (!user) {\r\n-        user = await User.create({\r\n-          name: `${profile.name?.givenName} ${profile.name?.familyName}`,\r\n-          email,\r\n-          password: \"facebook_oauth\",\r\n-        });\r\n-      }\r\n-      return done(null, user);\r\n-    }\r\n-  )\r\n-);\r\n+export default passport;\r\n"
                },
                {
                    "date": 1762460879398,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -49,9 +49,9 @@\n         }\r\n \r\n         return done(null, user);\r\n       } catch (err) {\r\n-        return done(err, null);\r\n+        // return done(err, null);\r\n       }\r\n     }\r\n   )\r\n );\r\n"
                },
                {
                    "date": 1762460887629,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,4 @@\n-import dotenv from \"dotenv\";\r\n-dotenv.config(); // ‚úÖ Must be at the top\r\n-\r\n import passport from \"passport\";\r\n import { Strategy as GoogleStrategy } from \"passport-google-oauth20\";\r\n import { Strategy as FacebookStrategy } from \"passport-facebook\";\r\n import { User } from \"../models/User\";\r\n@@ -9,81 +6,59 @@\n interface SerializedUser {\r\n   id: string;\r\n }\r\n \r\n-// ‚úÖ Serialize user\r\n-passport.serializeUser((user: any, done) => {\r\n-  done(null, user.id);\r\n+// Serialize the user ID into the session\r\n+passport.serializeUser((user: Express.User | SerializedUser, done) => {\r\n+  done(null, (user as SerializedUser).id);\r\n });\r\n \r\n-// ‚úÖ Deserialize user\r\n+// Deserialize the user ID from the session\r\n passport.deserializeUser((id: string, done) => {\r\n+  // Here you‚Äôd fetch the user from the database\r\n   done(null, { id });\r\n });\r\n-\r\n-// üß© Debug print (check env loading)\r\n-console.log(\"üîç Google OAuth ENV:\", {\r\n-  id: process.env.GOOGLE_CLIENT_ID,\r\n-  secret: process.env.GOOGLE_CLIENT_SECRET ? \"‚úÖ Loaded\" : \"‚ùå Missing\",\r\n-  callback: process.env.GOOGLE_CALLBACK_URL,\r\n-});\r\n-\r\n // ‚úÖ Google Strategy\r\n passport.use(\r\n   new GoogleStrategy(\r\n     {\r\n-      clientID: process.env.GOOGLE_CLIENT_ID || \"\",\r\n-      clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"\",\r\n-      callbackURL: process.env.GOOGLE_CALLBACK_URL || \"\",\r\n+      clientID: process.env.GOOGLE_CLIENT_ID!,\r\n+      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\r\n+      callbackURL: \"http://localhost:5000/api/auth/google/callback\",\r\n     },\r\n     async (_accessToken, _refreshToken, profile, done) => {\r\n-      try {\r\n-        const email = profile.emails?.[0].value;\r\n-        let user = await User.findOne({ email });\r\n-\r\n-        if (!user) {\r\n-          user = await User.create({\r\n-            name: profile.displayName,\r\n-            email,\r\n-            password: \"google_oauth\",\r\n-          });\r\n-        }\r\n-\r\n-        return done(null, user);\r\n-      } catch (err) {\r\n-        // return done(err, null);\r\n+      let user = await User.findOne({ email: profile.emails?.[0].value });\r\n+      if (!user) {\r\n+        user = await User.create({\r\n+          name: profile.displayName,\r\n+          email: profile.emails?.[0].value,\r\n+          password: \"google_oauth\",\r\n+        });\r\n       }\r\n+      return done(null, user);\r\n     }\r\n   )\r\n );\r\n \r\n-// ‚úÖ Facebook Strategy (optional)\r\n+// ‚úÖ Facebook Strategy\r\n passport.use(\r\n   new FacebookStrategy(\r\n     {\r\n-      clientID: process.env.FACEBOOK_APP_ID || \"\",\r\n-      clientSecret: process.env.FACEBOOK_APP_SECRET || \"\",\r\n+      clientID: process.env.FACEBOOK_APP_ID!,\r\n+      clientSecret: process.env.FACEBOOK_APP_SECRET!,\r\n       callbackURL: \"http://localhost:5000/api/auth/facebook/callback\",\r\n       profileFields: [\"id\", \"emails\", \"name\"],\r\n     },\r\n     async (_accessToken, _refreshToken, profile, done) => {\r\n-      try {\r\n-        const email = profile.emails?.[0].value;\r\n-        let user = await User.findOne({ email });\r\n-\r\n-        if (!user) {\r\n-          user = await User.create({\r\n-            name: `${profile.name?.givenName} ${profile.name?.familyName}`,\r\n-            email,\r\n-            password: \"facebook_oauth\",\r\n-          });\r\n-        }\r\n-\r\n-        return done(null, user);\r\n-      } catch (err) {\r\n-        return done(err, null);\r\n+      let email = profile.emails?.[0].value;\r\n+      let user = await User.findOne({ email });\r\n+      if (!user) {\r\n+        user = await User.create({\r\n+          name: `${profile.name?.givenName} ${profile.name?.familyName}`,\r\n+          email,\r\n+          password: \"facebook_oauth\",\r\n+        });\r\n       }\r\n+      return done(null, user);\r\n     }\r\n   )\r\n );\r\n-\r\n-export default passport;\r\n"
                },
                {
                    "date": 1762460900398,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,4 +1,7 @@\n+import dotenv from \"dotenv\";\r\n+dotenv.config(); // ‚úÖ Must be at the top\r\n+\r\n import passport from \"passport\";\r\n import { Strategy as GoogleStrategy } from \"passport-google-oauth20\";\r\n import { Strategy as FacebookStrategy } from \"passport-facebook\";\r\n import { User } from \"../models/User\";\r\n@@ -6,59 +9,81 @@\n interface SerializedUser {\r\n   id: string;\r\n }\r\n \r\n-// Serialize the user ID into the session\r\n-passport.serializeUser((user: Express.User | SerializedUser, done) => {\r\n-  done(null, (user as SerializedUser).id);\r\n+// ‚úÖ Serialize user\r\n+passport.serializeUser((user: any, done) => {\r\n+  done(null, user.id);\r\n });\r\n \r\n-// Deserialize the user ID from the session\r\n+// ‚úÖ Deserialize user\r\n passport.deserializeUser((id: string, done) => {\r\n-  // Here you‚Äôd fetch the user from the database\r\n   done(null, { id });\r\n });\r\n+\r\n+// üß© Debug print (check env loading)\r\n+console.log(\"üîç Google OAuth ENV:\", {\r\n+  id: process.env.GOOGLE_CLIENT_ID,\r\n+  secret: process.env.GOOGLE_CLIENT_SECRET ? \"‚úÖ Loaded\" : \"‚ùå Missing\",\r\n+  callback: process.env.GOOGLE_CALLBACK_URL,\r\n+});\r\n+\r\n // ‚úÖ Google Strategy\r\n passport.use(\r\n   new GoogleStrategy(\r\n     {\r\n-      clientID: process.env.GOOGLE_CLIENT_ID!,\r\n-      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\r\n-      callbackURL: \"http://localhost:5000/api/auth/google/callback\",\r\n+      clientID: process.env.GOOGLE_CLIENT_ID || \"\",\r\n+      clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"\",\r\n+      callbackURL: process.env.GOOGLE_CALLBACK_URL || \"\",\r\n     },\r\n     async (_accessToken, _refreshToken, profile, done) => {\r\n-      let user = await User.findOne({ email: profile.emails?.[0].value });\r\n-      if (!user) {\r\n-        user = await User.create({\r\n-          name: profile.displayName,\r\n-          email: profile.emails?.[0].value,\r\n-          password: \"google_oauth\",\r\n-        });\r\n+      try {\r\n+        const email = profile.emails?.[0].value;\r\n+        let user = await User.findOne({ email });\r\n+\r\n+        if (!user) {\r\n+          user = await User.create({\r\n+            name: profile.displayName,\r\n+            email,\r\n+            password: \"google_oauth\",\r\n+          });\r\n+        }\r\n+\r\n+        return done(null, user);\r\n+      } catch (err) {\r\n+        return done(err, null);\r\n       }\r\n-      return done(null, user);\r\n     }\r\n   )\r\n );\r\n \r\n-// ‚úÖ Facebook Strategy\r\n+// ‚úÖ Facebook Strategy (optional)\r\n passport.use(\r\n   new FacebookStrategy(\r\n     {\r\n-      clientID: process.env.FACEBOOK_APP_ID!,\r\n-      clientSecret: process.env.FACEBOOK_APP_SECRET!,\r\n+      clientID: process.env.FACEBOOK_APP_ID || \"\",\r\n+      clientSecret: process.env.FACEBOOK_APP_SECRET || \"\",\r\n       callbackURL: \"http://localhost:5000/api/auth/facebook/callback\",\r\n       profileFields: [\"id\", \"emails\", \"name\"],\r\n     },\r\n     async (_accessToken, _refreshToken, profile, done) => {\r\n-      let email = profile.emails?.[0].value;\r\n-      let user = await User.findOne({ email });\r\n-      if (!user) {\r\n-        user = await User.create({\r\n-          name: `${profile.name?.givenName} ${profile.name?.familyName}`,\r\n-          email,\r\n-          password: \"facebook_oauth\",\r\n-        });\r\n+      try {\r\n+        const email = profile.emails?.[0].value;\r\n+        let user = await User.findOne({ email });\r\n+\r\n+        if (!user) {\r\n+          user = await User.create({\r\n+            name: `${profile.name?.givenName} ${profile.name?.familyName}`,\r\n+            email,\r\n+            password: \"facebook_oauth\",\r\n+          });\r\n+        }\r\n+\r\n+        return done(null, user);\r\n+      } catch (err) {\r\n+        return done(err, null);\r\n       }\r\n-      return done(null, user);\r\n     }\r\n   )\r\n );\r\n+\r\n+export default passport;\r\n"
                },
                {
                    "date": 1762460908587,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,12 +10,11 @@\n   id: string;\r\n }\r\n \r\n // ‚úÖ Serialize user\r\n-passport.serializeUser((user: any, done) => {\r\n-  done(null, user.id);\r\n-});\r\n-\r\n+passport.serializeUser((user: Express.User | SerializedUser, done) => {\r\n+  done(null, (user as SerializedUser).id);\r\n+})\r\n // ‚úÖ Deserialize user\r\n passport.deserializeUser((id: string, done) => {\r\n   done(null, { id });\r\n });\r\n"
                },
                {
                    "date": 1762719213958,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -48,41 +48,41 @@\n         }\r\n \r\n         return done(null, user);\r\n       } catch (err) {\r\n-        return done(err, null);\r\n+        // return done(err, null);\r\n       }\r\n     }\r\n   )\r\n );\r\n \r\n // ‚úÖ Facebook Strategy (optional)\r\n-passport.use(\r\n-  new FacebookStrategy(\r\n-    {\r\n-      clientID: process.env.FACEBOOK_APP_ID || \"\",\r\n-      clientSecret: process.env.FACEBOOK_APP_SECRET || \"\",\r\n-      callbackURL: \"http://localhost:5000/api/auth/facebook/callback\",\r\n-      profileFields: [\"id\", \"emails\", \"name\"],\r\n-    },\r\n-    async (_accessToken, _refreshToken, profile, done) => {\r\n-      try {\r\n-        const email = profile.emails?.[0].value;\r\n-        let user = await User.findOne({ email });\r\n+// passport.use(\r\n+//   new FacebookStrategy(\r\n+//     {\r\n+//       clientID: process.env.FACEBOOK_APP_ID || \"\",\r\n+//       clientSecret: process.env.FACEBOOK_APP_SECRET || \"\",\r\n+//       callbackURL: \"http://localhost:5000/api/auth/facebook/callback\",\r\n+//       profileFields: [\"id\", \"emails\", \"name\"],\r\n+//     },\r\n+//     async (_accessToken, _refreshToken, profile, done) => {\r\n+//       try {\r\n+//         const email = profile.emails?.[0].value;\r\n+//         let user = await User.findOne({ email });\r\n \r\n-        if (!user) {\r\n-          user = await User.create({\r\n-            name: `${profile.name?.givenName} ${profile.name?.familyName}`,\r\n-            email,\r\n-            password: \"facebook_oauth\",\r\n-          });\r\n-        }\r\n+//         if (!user) {\r\n+//           user = await User.create({\r\n+//             name: `${profile.name?.givenName} ${profile.name?.familyName}`,\r\n+//             email,\r\n+//             password: \"facebook_oauth\",\r\n+//           });\r\n+//         }\r\n \r\n-        return done(null, user);\r\n-      } catch (err) {\r\n-        return done(err, null);\r\n-      }\r\n-    }\r\n-  )\r\n-);\r\n+//         return done(null, user);\r\n+//       } catch (err) {\r\n+//         return done(err, null);\r\n+//       }\r\n+//     }\r\n+//   )\r\n+// );\r\n \r\n export default passport;\r\n"
                },
                {
                    "date": 1762719641580,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -33,27 +33,31 @@\n       clientID: process.env.GOOGLE_CLIENT_ID || \"\",\r\n       clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"\",\r\n       callbackURL: process.env.GOOGLE_CALLBACK_URL || \"\",\r\n     },\r\n-    async (_accessToken, _refreshToken, profile, done) => {\r\n-      try {\r\n-        const email = profile.emails?.[0].value;\r\n-        let user = await User.findOne({ email });\r\n+   async (_accessToken, _refreshToken, profile, done) => {\r\n+  try {\r\n+    const email = profile.emails?.[0]?.value || `${profile.id}@google.com`;\r\n+    let user = await User.findOne({ email });\r\n \r\n-        if (!user) {\r\n-          user = await User.create({\r\n-            name: profile.displayName,\r\n-            email,\r\n-            password: \"google_oauth\",\r\n-          });\r\n-        }\r\n+    if (!user) {\r\n+      console.log(\"üÜï Creating new Google user:\", email);\r\n+      user = await User.create({\r\n+        name: profile.displayName,\r\n+        email,\r\n+        password: \"google_oauth\",\r\n+      });\r\n+    } else {\r\n+      console.log(\"üë§ Existing Google user:\", email);\r\n+    }\r\n \r\n-        return done(null, user);\r\n-      } catch (err) {\r\n-        // return done(err, null);\r\n-      }\r\n-    }\r\n-  )\r\n+    return done(null, user);\r\n+  } catch (err) {\r\n+    console.error(\"‚ùå Google OAuth Error:\", err);\r\n+    return done(err, null);\r\n+  }\r\n+}\r\n+\r\n );\r\n \r\n // ‚úÖ Facebook Strategy (optional)\r\n // passport.use(\r\n"
                },
                {
                    "date": 1762719659058,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -56,8 +56,9 @@\n     return done(err, null);\r\n   }\r\n }\r\n \r\n+  )\r\n );\r\n \r\n // ‚úÖ Facebook Strategy (optional)\r\n // passport.use(\r\n"
                },
                {
                    "date": 1762719918008,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -52,9 +52,10 @@\n \r\n     return done(null, user);\r\n   } catch (err) {\r\n     console.error(\"‚ùå Google OAuth Error:\", err);\r\n-    return done(err, null);\r\n+    return done(err, false);\r\n+\r\n   }\r\n }\r\n \r\n   )\r\n"
                },
                {
                    "date": 1763050032047,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,94 +1,41 @@\n-import dotenv from \"dotenv\";\r\n-dotenv.config(); // ‚úÖ Must be at the top\r\n+import jwt from \"jsonwebtoken\";\r\n \r\n-import passport from \"passport\";\r\n-import { Strategy as GoogleStrategy } from \"passport-google-oauth20\";\r\n-import { Strategy as FacebookStrategy } from \"passport-facebook\";\r\n-import { User } from \"../models/User\";\r\n-\r\n-interface SerializedUser {\r\n-  id: string;\r\n-}\r\n-\r\n-// ‚úÖ Serialize user\r\n-passport.serializeUser((user: Express.User | SerializedUser, done) => {\r\n-  done(null, (user as SerializedUser).id);\r\n-})\r\n-// ‚úÖ Deserialize user\r\n-passport.deserializeUser((id: string, done) => {\r\n-  done(null, { id });\r\n-});\r\n-\r\n-// üß© Debug print (check env loading)\r\n-console.log(\"üîç Google OAuth ENV:\", {\r\n-  id: process.env.GOOGLE_CLIENT_ID,\r\n-  secret: process.env.GOOGLE_CLIENT_SECRET ? \"‚úÖ Loaded\" : \"‚ùå Missing\",\r\n-  callback: process.env.GOOGLE_CALLBACK_URL,\r\n-});\r\n-\r\n-// ‚úÖ Google Strategy\r\n+// inside your GoogleStrategy callback\r\n passport.use(\r\n   new GoogleStrategy(\r\n     {\r\n       clientID: process.env.GOOGLE_CLIENT_ID || \"\",\r\n       clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"\",\r\n       callbackURL: process.env.GOOGLE_CALLBACK_URL || \"\",\r\n     },\r\n-   async (_accessToken, _refreshToken, profile, done) => {\r\n-  try {\r\n-    const email = profile.emails?.[0]?.value || `${profile.id}@google.com`;\r\n-    let user = await User.findOne({ email });\r\n+    async (_accessToken, _refreshToken, profile, done) => {\r\n+      try {\r\n+        const email = profile.emails?.[0]?.value || `${profile.id}@google.com`;\r\n+        let user = await User.findOne({ email });\r\n \r\n-    if (!user) {\r\n-      console.log(\"üÜï Creating new Google user:\", email);\r\n-      user = await User.create({\r\n-        name: profile.displayName,\r\n-        email,\r\n-        password: \"google_oauth\",\r\n-      });\r\n-    } else {\r\n-      console.log(\"üë§ Existing Google user:\", email);\r\n-    }\r\n+        if (!user) {\r\n+          console.log(\"üÜï Creating new Google user:\", email);\r\n+          user = await User.create({\r\n+            name: profile.displayName,\r\n+            email,\r\n+            password: \"google_oauth\",\r\n+          });\r\n+        } else {\r\n+          console.log(\"üë§ Existing Google user:\", email);\r\n+        }\r\n \r\n-    return done(null, user);\r\n-  } catch (err) {\r\n-    console.error(\"‚ùå Google OAuth Error:\", err);\r\n-    return done(err, false);\r\n+        // ‚úÖ Generate JWT for frontend\r\n+        const token = jwt.sign(\r\n+          { id: user._id, name: user.name, email: user.email },\r\n+          process.env.JWT_SECRET || \"secretkey\",\r\n+          { expiresIn: \"1d\" }\r\n+        );\r\n \r\n-  }\r\n-}\r\n-\r\n+        return done(null, { user, token }); // return token along with user\r\n+      } catch (err) {\r\n+        console.error(\"‚ùå Google OAuth Error:\", err);\r\n+        return done(err, false);\r\n+      }\r\n+    }\r\n   )\r\n );\r\n-\r\n-// ‚úÖ Facebook Strategy (optional)\r\n-// passport.use(\r\n-//   new FacebookStrategy(\r\n-//     {\r\n-//       clientID: process.env.FACEBOOK_APP_ID || \"\",\r\n-//       clientSecret: process.env.FACEBOOK_APP_SECRET || \"\",\r\n-//       callbackURL: \"http://localhost:5000/api/auth/facebook/callback\",\r\n-//       profileFields: [\"id\", \"emails\", \"name\"],\r\n-//     },\r\n-//     async (_accessToken, _refreshToken, profile, done) => {\r\n-//       try {\r\n-//         const email = profile.emails?.[0].value;\r\n-//         let user = await User.findOne({ email });\r\n-\r\n-//         if (!user) {\r\n-//           user = await User.create({\r\n-//             name: `${profile.name?.givenName} ${profile.name?.familyName}`,\r\n-//             email,\r\n-//             password: \"facebook_oauth\",\r\n-//           });\r\n-//         }\r\n-\r\n-//         return done(null, user);\r\n-//       } catch (err) {\r\n-//         return done(err, null);\r\n-//       }\r\n-//     }\r\n-//   )\r\n-// );\r\n-\r\n-export default passport;\r\n"
                },
                {
                    "date": 1763050040319,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,41 +1,94 @@\n-import jwt from \"jsonwebtoken\";\r\n+import dotenv from \"dotenv\";\r\n+dotenv.config(); // ‚úÖ Must be at the top\r\n \r\n-// inside your GoogleStrategy callback\r\n+import passport from \"passport\";\r\n+import { Strategy as GoogleStrategy } from \"passport-google-oauth20\";\r\n+import { Strategy as FacebookStrategy } from \"passport-facebook\";\r\n+import { User } from \"../models/User\";\r\n+\r\n+interface SerializedUser {\r\n+  id: string;\r\n+}\r\n+\r\n+// ‚úÖ Serialize user\r\n+passport.serializeUser((user: Express.User | SerializedUser, done) => {\r\n+  done(null, (user as SerializedUser).id);\r\n+})\r\n+// ‚úÖ Deserialize user\r\n+passport.deserializeUser((id: string, done) => {\r\n+  done(null, { id });\r\n+});\r\n+\r\n+// üß© Debug print (check env loading)\r\n+console.log(\"üîç Google OAuth ENV:\", {\r\n+  id: process.env.GOOGLE_CLIENT_ID,\r\n+  secret: process.env.GOOGLE_CLIENT_SECRET ? \"‚úÖ Loaded\" : \"‚ùå Missing\",\r\n+  callback: process.env.GOOGLE_CALLBACK_URL,\r\n+});\r\n+\r\n+// ‚úÖ Google Strategy\r\n passport.use(\r\n   new GoogleStrategy(\r\n     {\r\n       clientID: process.env.GOOGLE_CLIENT_ID || \"\",\r\n       clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"\",\r\n       callbackURL: process.env.GOOGLE_CALLBACK_URL || \"\",\r\n     },\r\n-    async (_accessToken, _refreshToken, profile, done) => {\r\n-      try {\r\n-        const email = profile.emails?.[0]?.value || `${profile.id}@google.com`;\r\n-        let user = await User.findOne({ email });\r\n+   async (_accessToken, _refreshToken, profile, done) => {\r\n+  try {\r\n+    const email = profile.emails?.[0]?.value || `${profile.id}@google.com`;\r\n+    let user = await User.findOne({ email });\r\n \r\n-        if (!user) {\r\n-          console.log(\"üÜï Creating new Google user:\", email);\r\n-          user = await User.create({\r\n-            name: profile.displayName,\r\n-            email,\r\n-            password: \"google_oauth\",\r\n-          });\r\n-        } else {\r\n-          console.log(\"üë§ Existing Google user:\", email);\r\n-        }\r\n+    if (!user) {\r\n+      console.log(\"üÜï Creating new Google user:\", email);\r\n+      user = await User.create({\r\n+        name: profile.displayName,\r\n+        email,\r\n+        password: \"google_oauth\",\r\n+      });\r\n+    } else {\r\n+      console.log(\"üë§ Existing Google user:\", email);\r\n+    }\r\n \r\n-        // ‚úÖ Generate JWT for frontend\r\n-        const token = jwt.sign(\r\n-          { id: user._id, name: user.name, email: user.email },\r\n-          process.env.JWT_SECRET || \"secretkey\",\r\n-          { expiresIn: \"1d\" }\r\n-        );\r\n+    return done(null, user);\r\n+  } catch (err) {\r\n+    console.error(\"‚ùå Google OAuth Error:\", err);\r\n+    return done(err, false);\r\n \r\n-        return done(null, { user, token }); // return token along with user\r\n-      } catch (err) {\r\n-        console.error(\"‚ùå Google OAuth Error:\", err);\r\n-        return done(err, false);\r\n-      }\r\n-    }\r\n+  }\r\n+}\r\n+\r\n   )\r\n );\r\n+\r\n+// ‚úÖ Facebook Strategy (optional)\r\n+// passport.use(\r\n+//   new FacebookStrategy(\r\n+//     {\r\n+//       clientID: process.env.FACEBOOK_APP_ID || \"\",\r\n+//       clientSecret: process.env.FACEBOOK_APP_SECRET || \"\",\r\n+//       callbackURL: \"http://localhost:5000/api/auth/facebook/callback\",\r\n+//       profileFields: [\"id\", \"emails\", \"name\"],\r\n+//     },\r\n+//     async (_accessToken, _refreshToken, profile, done) => {\r\n+//       try {\r\n+//         const email = profile.emails?.[0].value;\r\n+//         let user = await User.findOne({ email });\r\n+\r\n+//         if (!user) {\r\n+//           user = await User.create({\r\n+//             name: `${profile.name?.givenName} ${profile.name?.familyName}`,\r\n+//             email,\r\n+//             password: \"facebook_oauth\",\r\n+//           });\r\n+//         }\r\n+\r\n+//         return done(null, user);\r\n+//       } catch (err) {\r\n+//         return done(err, null);\r\n+//       }\r\n+//     }\r\n+//   )\r\n+// );\r\n+\r\n+export default passport;\r\n"
                },
                {
                    "date": 1763050078828,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -33,32 +33,41 @@\n       clientID: process.env.GOOGLE_CLIENT_ID || \"\",\r\n       clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"\",\r\n       callbackURL: process.env.GOOGLE_CALLBACK_URL || \"\",\r\n     },\r\n-   async (_accessToken, _refreshToken, profile, done) => {\r\n-  try {\r\n-    const email = profile.emails?.[0]?.value || `${profile.id}@google.com`;\r\n-    let user = await User.findOne({ email });\r\n+    async (_accessToken, _refreshToken, profile, done) => {\r\n+      try {\r\n+        const email = profile.emails?.[0]?.value || `${profile.id}@google.com`;\r\n+        let user = await User.findOne({ email });\r\n \r\n-    if (!user) {\r\n-      console.log(\"üÜï Creating new Google user:\", email);\r\n-      user = await User.create({\r\n-        name: profile.displayName,\r\n-        email,\r\n-        password: \"google_oauth\",\r\n-      });\r\n-    } else {\r\n-      console.log(\"üë§ Existing Google user:\", email);\r\n+        if (!user) {\r\n+          console.log(\"üÜï Creating new Google user:\", email);\r\n+          user = await User.create({\r\n+            name: profile.displayName,\r\n+            email,\r\n+            password: \"google_oauth\",\r\n+          });\r\n+        } else {\r\n+          console.log(\"üë§ Existing Google user:\", email);\r\n+        }\r\n+\r\n+        // ‚úÖ Generate JWT for frontend\r\n+        const token = jwt.sign(\r\n+          { id: user._id, name: user.name, email: user.email },\r\n+          process.env.JWT_SECRET || \"secretkey\",\r\n+          { expiresIn: \"1d\" }\r\n+        );\r\n+\r\n+        return done(null, { user, token }); // return token along with user\r\n+      } catch (err) {\r\n+        console.error(\"‚ùå Google OAuth Error:\", err);\r\n+        return done(err, false);\r\n+      }\r\n     }\r\n+  )\r\n+);\r\n \r\n-    return done(null, user);\r\n-  } catch (err) {\r\n-    console.error(\"‚ùå Google OAuth Error:\", err);\r\n-    return done(err, false);\r\n \r\n-  }\r\n-}\r\n-\r\n   )\r\n );\r\n \r\n // ‚úÖ Facebook Strategy (optional)\r\n"
                },
                {
                    "date": 1763050088053,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,9 +4,51 @@\n import passport from \"passport\";\r\n import { Strategy as GoogleStrategy } from \"passport-google-oauth20\";\r\n import { Strategy as FacebookStrategy } from \"passport-facebook\";\r\n import { User } from \"../models/User\";\r\n+import jwt from \"jsonwebtoken\";\r\n \r\n+// inside your GoogleStrategy callback\r\n+passport.use(\r\n+  new GoogleStrategy(\r\n+    {\r\n+      clientID: process.env.GOOGLE_CLIENT_ID || \"\",\r\n+      clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"\",\r\n+      callbackURL: process.env.GOOGLE_CALLBACK_URL || \"\",\r\n+    },\r\n+    async (_accessToken, _refreshToken, profile, done) => {\r\n+      try {\r\n+        const email = profile.emails?.[0]?.value || `${profile.id}@google.com`;\r\n+        let user = await User.findOne({ email });\r\n+\r\n+        if (!user) {\r\n+          console.log(\"üÜï Creating new Google user:\", email);\r\n+          user = await User.create({\r\n+            name: profile.displayName,\r\n+            email,\r\n+            password: \"google_oauth\",\r\n+          });\r\n+        } else {\r\n+          console.log(\"üë§ Existing Google user:\", email);\r\n+        }\r\n+\r\n+        // ‚úÖ Generate JWT for frontend\r\n+        const token = jwt.sign(\r\n+          { id: user._id, name: user.name, email: user.email },\r\n+          process.env.JWT_SECRET || \"secretkey\",\r\n+          { expiresIn: \"1d\" }\r\n+        );\r\n+\r\n+        return done(null, { user, token }); // return token along with user\r\n+      } catch (err) {\r\n+        console.error(\"‚ùå Google OAuth Error:\", err);\r\n+        return done(err, false);\r\n+      }\r\n+    }\r\n+  )\r\n+);\r\n+\r\n+\r\n interface SerializedUser {\r\n   id: string;\r\n }\r\n \r\n@@ -66,11 +108,10 @@\n   )\r\n );\r\n \r\n \r\n-  )\r\n-);\r\n \r\n+\r\n // ‚úÖ Facebook Strategy (optional)\r\n // passport.use(\r\n //   new FacebookStrategy(\r\n //     {\r\n"
                },
                {
                    "date": 1763051474428,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,14 +1,34 @@\n+// src/config/passport.ts\r\n import dotenv from \"dotenv\";\r\n-dotenv.config(); // ‚úÖ Must be at the top\r\n+dotenv.config();\r\n \r\n import passport from \"passport\";\r\n import { Strategy as GoogleStrategy } from \"passport-google-oauth20\";\r\n import { Strategy as FacebookStrategy } from \"passport-facebook\";\r\n import { User } from \"../models/User\";\r\n import jwt from \"jsonwebtoken\";\r\n \r\n-// inside your GoogleStrategy callback\r\n+// -----------------------------\r\n+// Serialize/Deserialize for sessions\r\n+// -----------------------------\r\n+passport.serializeUser((user: any, done) => {\r\n+  // Store only user._id in session\r\n+  done(null, user._id?.toString() || user.id);\r\n+});\r\n+\r\n+passport.deserializeUser(async (id: string, done) => {\r\n+  try {\r\n+    const user = await User.findById(id).select(\"-password\");\r\n+    done(null, user);\r\n+  } catch (err) {\r\n+    done(err, null);\r\n+  }\r\n+});\r\n+\r\n+// -----------------------------\r\n+// Google OAuth Strategy\r\n+// -----------------------------\r\n passport.use(\r\n   new GoogleStrategy(\r\n     {\r\n       clientID: process.env.GOOGLE_CLIENT_ID || \"\",\r\n@@ -30,115 +50,65 @@\n         } else {\r\n           console.log(\"üë§ Existing Google user:\", email);\r\n         }\r\n \r\n-        // ‚úÖ Generate JWT for frontend\r\n+        // Generate JWT for frontend\r\n         const token = jwt.sign(\r\n           { id: user._id, name: user.name, email: user.email },\r\n           process.env.JWT_SECRET || \"secretkey\",\r\n           { expiresIn: \"1d\" }\r\n         );\r\n \r\n-        return done(null, { user, token }); // return token along with user\r\n+        // Return both user and token\r\n+        return done(null, { user, token });\r\n       } catch (err) {\r\n         console.error(\"‚ùå Google OAuth Error:\", err);\r\n         return done(err, false);\r\n       }\r\n     }\r\n   )\r\n );\r\n \r\n-\r\n-interface SerializedUser {\r\n-  id: string;\r\n-}\r\n-\r\n-// ‚úÖ Serialize user\r\n-passport.serializeUser((user: Express.User | SerializedUser, done) => {\r\n-  done(null, (user as SerializedUser).id);\r\n-})\r\n-// ‚úÖ Deserialize user\r\n-passport.deserializeUser((id: string, done) => {\r\n-  done(null, { id });\r\n-});\r\n-\r\n-// üß© Debug print (check env loading)\r\n-console.log(\"üîç Google OAuth ENV:\", {\r\n-  id: process.env.GOOGLE_CLIENT_ID,\r\n-  secret: process.env.GOOGLE_CLIENT_SECRET ? \"‚úÖ Loaded\" : \"‚ùå Missing\",\r\n-  callback: process.env.GOOGLE_CALLBACK_URL,\r\n-});\r\n-\r\n-// ‚úÖ Google Strategy\r\n+// -----------------------------\r\n+// Optional Facebook OAuth Strategy\r\n+// -----------------------------\r\n+/*\r\n passport.use(\r\n-  new GoogleStrategy(\r\n+  new FacebookStrategy(\r\n     {\r\n-      clientID: process.env.GOOGLE_CLIENT_ID || \"\",\r\n-      clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"\",\r\n-      callbackURL: process.env.GOOGLE_CALLBACK_URL || \"\",\r\n+      clientID: process.env.FACEBOOK_APP_ID || \"\",\r\n+      clientSecret: process.env.FACEBOOK_APP_SECRET || \"\",\r\n+      callbackURL: \"http://localhost:5000/api/auth/facebook/callback\",\r\n+      profileFields: [\"id\", \"emails\", \"name\"],\r\n     },\r\n     async (_accessToken, _refreshToken, profile, done) => {\r\n       try {\r\n-        const email = profile.emails?.[0]?.value || `${profile.id}@google.com`;\r\n+        const email = profile.emails?.[0].value;\r\n         let user = await User.findOne({ email });\r\n \r\n         if (!user) {\r\n-          console.log(\"üÜï Creating new Google user:\", email);\r\n           user = await User.create({\r\n-            name: profile.displayName,\r\n+            name: `${profile.name?.givenName} ${profile.name?.familyName}`,\r\n             email,\r\n-            password: \"google_oauth\",\r\n+            password: \"facebook_oauth\",\r\n           });\r\n-        } else {\r\n-          console.log(\"üë§ Existing Google user:\", email);\r\n         }\r\n \r\n-        // ‚úÖ Generate JWT for frontend\r\n-        const token = jwt.sign(\r\n-          { id: user._id, name: user.name, email: user.email },\r\n-          process.env.JWT_SECRET || \"secretkey\",\r\n-          { expiresIn: \"1d\" }\r\n-        );\r\n-\r\n-        return done(null, { user, token }); // return token along with user\r\n+        return done(null, user);\r\n       } catch (err) {\r\n-        console.error(\"‚ùå Google OAuth Error:\", err);\r\n-        return done(err, false);\r\n+        return done(err, null);\r\n       }\r\n     }\r\n   )\r\n );\r\n+*/\r\n \r\n+// -----------------------------\r\n+// Debug environment\r\n+// -----------------------------\r\n+console.log(\"üîç Google OAuth ENV:\", {\r\n+  id: process.env.GOOGLE_CLIENT_ID,\r\n+  secret: process.env.GOOGLE_CLIENT_SECRET ? \"‚úÖ Loaded\" : \"‚ùå Missing\",\r\n+  callback: process.env.GOOGLE_CALLBACK_URL,\r\n+});\r\n \r\n-\r\n-\r\n-// ‚úÖ Facebook Strategy (optional)\r\n-// passport.use(\r\n-//   new FacebookStrategy(\r\n-//     {\r\n-//       clientID: process.env.FACEBOOK_APP_ID || \"\",\r\n-//       clientSecret: process.env.FACEBOOK_APP_SECRET || \"\",\r\n-//       callbackURL: \"http://localhost:5000/api/auth/facebook/callback\",\r\n-//       profileFields: [\"id\", \"emails\", \"name\"],\r\n-//     },\r\n-//     async (_accessToken, _refreshToken, profile, done) => {\r\n-//       try {\r\n-//         const email = profile.emails?.[0].value;\r\n-//         let user = await User.findOne({ email });\r\n-\r\n-//         if (!user) {\r\n-//           user = await User.create({\r\n-//             name: `${profile.name?.givenName} ${profile.name?.familyName}`,\r\n-//             email,\r\n-//             password: \"facebook_oauth\",\r\n-//           });\r\n-//         }\r\n-\r\n-//         return done(null, user);\r\n-//       } catch (err) {\r\n-//         return done(err, null);\r\n-//       }\r\n-//     }\r\n-//   )\r\n-// );\r\n-\r\n export default passport;\r\n"
                },
                {
                    "date": 1763051512542,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,11 +10,19 @@\n \r\n // -----------------------------\r\n // Serialize/Deserialize for sessions\r\n // -----------------------------\r\n-passport.serializeUser((user: any, done) => {\r\n-  // Store only user._id in session\r\n-  done(null, user._id?.toString() || user.id);\r\n+passport.serializeUser((user: unknown, done) => {\r\n+  // Narrow unknown to a User-like shape before accessing properties\r\n+  type UserLike = { _id?: { toString(): string }; id?: string };\r\n+\r\n+  if (typeof user === \"object\" && user !== null) {\r\n+    const u = user as UserLike;\r\n+    // Store only user._id in session\r\n+    done(null, u._id?.toString() || u.id);\r\n+  } else {\r\n+    done(new Error(\"Invalid user object\"), null);\r\n+  }\r\n });\r\n \r\n passport.deserializeUser(async (id: string, done) => {\r\n   try {\r\n"
                },
                {
                    "date": 1763051713575,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,29 +10,29 @@\n \r\n // -----------------------------\r\n // Serialize/Deserialize for sessions\r\n // -----------------------------\r\n-passport.serializeUser((user: unknown, done) => {\r\n-  // Narrow unknown to a User-like shape before accessing properties\r\n-  type UserLike = { _id?: { toString(): string }; id?: string };\r\n+// passport.serializeUser((user: unknown, done) => {\r\n+//   // Narrow unknown to a User-like shape before accessing properties\r\n+//   type UserLike = { _id?: { toString(): string }; id?: string };\r\n \r\n-  if (typeof user === \"object\" && user !== null) {\r\n-    const u = user as UserLike;\r\n-    // Store only user._id in session\r\n-    done(null, u._id?.toString() || u.id);\r\n-  } else {\r\n-    done(new Error(\"Invalid user object\"), null);\r\n-  }\r\n-});\r\n+//   if (typeof user === \"object\" && user !== null) {\r\n+//     const u = user as UserLike;\r\n+//     // Store only user._id in session\r\n+//     done(null, u._id?.toString() || u.id);\r\n+//   } else {\r\n+//     done(new Error(\"Invalid user object\"), null);\r\n+//   }\r\n+// });\r\n \r\n-passport.deserializeUser(async (id: string, done) => {\r\n-  try {\r\n-    const user = await User.findById(id).select(\"-password\");\r\n-    done(null, user);\r\n-  } catch (err) {\r\n-    done(err, null);\r\n-  }\r\n-});\r\n+// passport.deserializeUser(async (id: string, done) => {\r\n+//   try {\r\n+//     const user = await User.findById(id).select(\"-password\");\r\n+//     done(null, user);\r\n+//   } catch (err) {\r\n+//     done(err, null);\r\n+//   }\r\n+// });\r\n \r\n // -----------------------------\r\n // Google OAuth Strategy\r\n // -----------------------------\r\n"
                },
                {
                    "date": 1763051863450,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,42 +1,13 @@\n-// src/config/passport.ts\r\n import dotenv from \"dotenv\";\r\n dotenv.config();\r\n \r\n import passport from \"passport\";\r\n import { Strategy as GoogleStrategy } from \"passport-google-oauth20\";\r\n-import { Strategy as FacebookStrategy } from \"passport-facebook\";\r\n import { User } from \"../models/User\";\r\n import jwt from \"jsonwebtoken\";\r\n \r\n-// -----------------------------\r\n-// Serialize/Deserialize for sessions\r\n-// -----------------------------\r\n-// passport.serializeUser((user: unknown, done) => {\r\n-//   // Narrow unknown to a User-like shape before accessing properties\r\n-//   type UserLike = { _id?: { toString(): string }; id?: string };\r\n-\r\n-//   if (typeof user === \"object\" && user !== null) {\r\n-//     const u = user as UserLike;\r\n-//     // Store only user._id in session\r\n-//     done(null, u._id?.toString() || u.id);\r\n-//   } else {\r\n-//     done(new Error(\"Invalid user object\"), null);\r\n-//   }\r\n-// });\r\n-\r\n-// passport.deserializeUser(async (id: string, done) => {\r\n-//   try {\r\n-//     const user = await User.findById(id).select(\"-password\");\r\n-//     done(null, user);\r\n-//   } catch (err) {\r\n-//     done(err, null);\r\n-//   }\r\n-// });\r\n-\r\n-// -----------------------------\r\n-// Google OAuth Strategy\r\n-// -----------------------------\r\n+// --- Google Strategy ---\r\n passport.use(\r\n   new GoogleStrategy(\r\n     {\r\n       clientID: process.env.GOOGLE_CLIENT_ID || \"\",\r\n@@ -48,75 +19,26 @@\n         const email = profile.emails?.[0]?.value || `${profile.id}@google.com`;\r\n         let user = await User.findOne({ email });\r\n \r\n         if (!user) {\r\n-          console.log(\"üÜï Creating new Google user:\", email);\r\n           user = await User.create({\r\n             name: profile.displayName,\r\n             email,\r\n             password: \"google_oauth\",\r\n           });\r\n-        } else {\r\n-          console.log(\"üë§ Existing Google user:\", email);\r\n         }\r\n \r\n-        // Generate JWT for frontend\r\n         const token = jwt.sign(\r\n           { id: user._id, name: user.name, email: user.email },\r\n           process.env.JWT_SECRET || \"secretkey\",\r\n-          { expiresIn: \"1d\" }\r\n+          { expiresIn: \"7d\" }\r\n         );\r\n \r\n-        // Return both user and token\r\n-        return done(null, { user, token });\r\n+        return done(null, { user, token }); // send token with user\r\n       } catch (err) {\r\n-        console.error(\"‚ùå Google OAuth Error:\", err);\r\n         return done(err, false);\r\n       }\r\n     }\r\n   )\r\n );\r\n \r\n-// -----------------------------\r\n-// Optional Facebook OAuth Strategy\r\n-// -----------------------------\r\n-/*\r\n-passport.use(\r\n-  new FacebookStrategy(\r\n-    {\r\n-      clientID: process.env.FACEBOOK_APP_ID || \"\",\r\n-      clientSecret: process.env.FACEBOOK_APP_SECRET || \"\",\r\n-      callbackURL: \"http://localhost:5000/api/auth/facebook/callback\",\r\n-      profileFields: [\"id\", \"emails\", \"name\"],\r\n-    },\r\n-    async (_accessToken, _refreshToken, profile, done) => {\r\n-      try {\r\n-        const email = profile.emails?.[0].value;\r\n-        let user = await User.findOne({ email });\r\n-\r\n-        if (!user) {\r\n-          user = await User.create({\r\n-            name: `${profile.name?.givenName} ${profile.name?.familyName}`,\r\n-            email,\r\n-            password: \"facebook_oauth\",\r\n-          });\r\n-        }\r\n-\r\n-        return done(null, user);\r\n-      } catch (err) {\r\n-        return done(err, null);\r\n-      }\r\n-    }\r\n-  )\r\n-);\r\n-*/\r\n-\r\n-// -----------------------------\r\n-// Debug environment\r\n-// -----------------------------\r\n-console.log(\"üîç Google OAuth ENV:\", {\r\n-  id: process.env.GOOGLE_CLIENT_ID,\r\n-  secret: process.env.GOOGLE_CLIENT_SECRET ? \"‚úÖ Loaded\" : \"‚ùå Missing\",\r\n-  callback: process.env.GOOGLE_CALLBACK_URL,\r\n-});\r\n-\r\n export default passport;\r\n"
                },
                {
                    "date": 1763056361127,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,13 +1,24 @@\n+// src/config/passport.ts\r\n import dotenv from \"dotenv\";\r\n dotenv.config();\r\n \r\n import passport from \"passport\";\r\n import { Strategy as GoogleStrategy } from \"passport-google-oauth20\";\r\n import { User } from \"../models/User\";\r\n import jwt from \"jsonwebtoken\";\r\n \r\n-// --- Google Strategy ---\r\n+// Interface for the object returned by Passport strategy\r\n+interface UserWithToken {\r\n+  user: {\r\n+    _id: string;\r\n+    name: string;\r\n+    email: string;\r\n+  };\r\n+  token: string;\r\n+}\r\n+\r\n+// --- Google OAuth Strategy ---\r\n passport.use(\r\n   new GoogleStrategy(\r\n     {\r\n       clientID: process.env.GOOGLE_CLIENT_ID || \"\",\r\n@@ -26,19 +37,23 @@\n             password: \"google_oauth\",\r\n           });\r\n         }\r\n \r\n+        // Generate JWT token\r\n         const token = jwt.sign(\r\n           { id: user._id, name: user.name, email: user.email },\r\n           process.env.JWT_SECRET || \"secretkey\",\r\n           { expiresIn: \"7d\" }\r\n         );\r\n \r\n-        return done(null, { user, token }); // send token with user\r\n+        const result: UserWithToken = { user, token };\r\n+        return done(null, result); // send user + token\r\n       } catch (err) {\r\n+        console.error(\"Google OAuth Error:\", err);\r\n         return done(err, false);\r\n       }\r\n     }\r\n   )\r\n );\r\n \r\n+// ‚úÖ Export Passport\r\n export default passport;\r\n"
                },
                {
                    "date": 1763202131482,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,12 +3,12 @@\n dotenv.config();\r\n \r\n import passport from \"passport\";\r\n import { Strategy as GoogleStrategy } from \"passport-google-oauth20\";\r\n+import { Strategy as JwtStrategy, ExtractJwt } from \"passport-jwt\";\r\n import { User } from \"../models/User\";\r\n import jwt from \"jsonwebtoken\";\r\n \r\n-// Interface for the object returned by Passport strategy\r\n interface UserWithToken {\r\n   user: {\r\n     _id: string;\r\n     name: string;\r\n@@ -16,44 +16,81 @@\n   };\r\n   token: string;\r\n }\r\n \r\n-// --- Google OAuth Strategy ---\r\n+/**\r\n+ * GOOGLE OAUTH STRATEGY\r\n+ * (keeps your existing code but ensures 'done' returns user object and token)\r\n+ */\r\n+if (process.env.GOOGLE_CLIENT_ID && process.env.GOOGLE_CLIENT_SECRET) {\r\n+  passport.use(\r\n+    new GoogleStrategy(\r\n+      {\r\n+        clientID: process.env.GOOGLE_CLIENT_ID,\r\n+        clientSecret: process.env.GOOGLE_CLIENT_SECRET,\r\n+        callbackURL: process.env.GOOGLE_CALLBACK_URL,\r\n+      },\r\n+      async (_accessToken, _refreshToken, profile, done) => {\r\n+        try {\r\n+          const email = profile.emails?.[0]?.value || `${profile.id}@google.com`;\r\n+          let user = await User.findOne({ email });\r\n+\r\n+          if (!user) {\r\n+            user = await User.create({\r\n+              name: profile.displayName,\r\n+              email,\r\n+              password: \"google_oauth\",\r\n+            });\r\n+          }\r\n+\r\n+          const token = jwt.sign(\r\n+            { id: user._id, name: user.name, email: user.email },\r\n+            process.env.JWT_SECRET || \"secretkey\",\r\n+            { expiresIn: \"7d\" }\r\n+          );\r\n+\r\n+          const result: UserWithToken = { user: { _id: user._id.toString(), name: user.name, email: user.email }, token };\r\n+          return done(null, result);\r\n+        } catch (err) {\r\n+          console.error(\"Google OAuth Error:\", err);\r\n+          return done(err as Error, false);\r\n+        }\r\n+      }\r\n+    )\r\n+  );\r\n+}\r\n+\r\n+/**\r\n+ * JWT STRATEGY\r\n+ * This will let you protect routes with `passport.authenticate(\"jwt\", { session: false })`.\r\n+ * It expects JWT payload to contain { id, name, email } as created elsewhere.\r\n+ */\r\n+const jwtSecret = process.env.JWT_SECRET || \"secretkey\";\r\n+\r\n passport.use(\r\n-  new GoogleStrategy(\r\n+  new JwtStrategy(\r\n     {\r\n-      clientID: process.env.GOOGLE_CLIENT_ID || \"\",\r\n-      clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"\",\r\n-      callbackURL: process.env.GOOGLE_CALLBACK_URL || \"\",\r\n+      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\r\n+      secretOrKey: jwtSecret,\r\n     },\r\n-    async (_accessToken, _refreshToken, profile, done) => {\r\n+    async (payload, done) => {\r\n       try {\r\n-        const email = profile.emails?.[0]?.value || `${profile.id}@google.com`;\r\n-        let user = await User.findOne({ email });\r\n-\r\n-        if (!user) {\r\n-          user = await User.create({\r\n-            name: profile.displayName,\r\n-            email,\r\n-            password: \"google_oauth\",\r\n-          });\r\n+        // payload should contain an `id` (user id)\r\n+        if (!payload || !payload.id) {\r\n+          return done(null, false);\r\n         }\r\n \r\n-        // Generate JWT token\r\n-        const token = jwt.sign(\r\n-          { id: user._id, name: user.name, email: user.email },\r\n-          process.env.JWT_SECRET || \"secretkey\",\r\n-          { expiresIn: \"7d\" }\r\n-        );\r\n+        // Optionally, you can fetch the user from DB to verify it still exists:\r\n+        const user = await User.findById(payload.id).select(\"_id name email\");\r\n+        if (!user) return done(null, false);\r\n \r\n-        const result: UserWithToken = { user, token };\r\n-        return done(null, result); // send user + token\r\n+        // attach a minimal user object to req.user\r\n+        return done(null, { id: user._id.toString(), name: user.name, email: user.email });\r\n       } catch (err) {\r\n-        console.error(\"Google OAuth Error:\", err);\r\n-        return done(err, false);\r\n+        console.error(\"JWT strategy error\", err);\r\n+        return done(err as Error, false);\r\n       }\r\n     }\r\n   )\r\n );\r\n \r\n-// ‚úÖ Export Passport\r\n export default passport;\r\n"
                },
                {
                    "date": 1763630214604,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,96 +1,96 @@\n-// src/config/passport.ts\r\n-import dotenv from \"dotenv\";\r\n-dotenv.config();\r\n+// // src/config/passport.ts\r\n+// import dotenv from \"dotenv\";\r\n+// dotenv.config();\r\n \r\n-import passport from \"passport\";\r\n-import { Strategy as GoogleStrategy } from \"passport-google-oauth20\";\r\n-import { Strategy as JwtStrategy, ExtractJwt } from \"passport-jwt\";\r\n-import { User } from \"../models/User\";\r\n-import jwt from \"jsonwebtoken\";\r\n+// import passport from \"passport\";\r\n+// import { Strategy as GoogleStrategy } from \"passport-google-oauth20\";\r\n+// import { Strategy as JwtStrategy, ExtractJwt } from \"passport-jwt\";\r\n+// import { User } from \"../models/User\";\r\n+// import jwt from \"jsonwebtoken\";\r\n \r\n-interface UserWithToken {\r\n-  user: {\r\n-    _id: string;\r\n-    name: string;\r\n-    email: string;\r\n-  };\r\n-  token: string;\r\n-}\r\n+// interface UserWithToken {\r\n+//   user: {\r\n+//     _id: string;\r\n+//     name: string;\r\n+//     email: string;\r\n+//   };\r\n+//   token: string;\r\n+// }\r\n \r\n-/**\r\n- * GOOGLE OAUTH STRATEGY\r\n- * (keeps your existing code but ensures 'done' returns user object and token)\r\n- */\r\n-if (process.env.GOOGLE_CLIENT_ID && process.env.GOOGLE_CLIENT_SECRET) {\r\n-  passport.use(\r\n-    new GoogleStrategy(\r\n-      {\r\n-        clientID: process.env.GOOGLE_CLIENT_ID,\r\n-        clientSecret: process.env.GOOGLE_CLIENT_SECRET,\r\n-        callbackURL: process.env.GOOGLE_CALLBACK_URL,\r\n-      },\r\n-      async (_accessToken, _refreshToken, profile, done) => {\r\n-        try {\r\n-          const email = profile.emails?.[0]?.value || `${profile.id}@google.com`;\r\n-          let user = await User.findOne({ email });\r\n+// /**\r\n+//  * GOOGLE OAUTH STRATEGY\r\n+//  * (keeps your existing code but ensures 'done' returns user object and token)\r\n+//  */\r\n+// if (process.env.GOOGLE_CLIENT_ID && process.env.GOOGLE_CLIENT_SECRET) {\r\n+//   passport.use(\r\n+//     new GoogleStrategy(\r\n+//       {\r\n+//         clientID: process.env.GOOGLE_CLIENT_ID,\r\n+//         clientSecret: process.env.GOOGLE_CLIENT_SECRET,\r\n+//         callbackURL: process.env.GOOGLE_CALLBACK_URL,\r\n+//       },\r\n+//       async (_accessToken, _refreshToken, profile, done) => {\r\n+//         try {\r\n+//           const email = profile.emails?.[0]?.value || `${profile.id}@google.com`;\r\n+//           let user = await User.findOne({ email });\r\n \r\n-          if (!user) {\r\n-            user = await User.create({\r\n-              name: profile.displayName,\r\n-              email,\r\n-              password: \"google_oauth\",\r\n-            });\r\n-          }\r\n+//           if (!user) {\r\n+//             user = await User.create({\r\n+//               name: profile.displayName,\r\n+//               email,\r\n+//               password: \"google_oauth\",\r\n+//             });\r\n+//           }\r\n \r\n-          const token = jwt.sign(\r\n-            { id: user._id, name: user.name, email: user.email },\r\n-            process.env.JWT_SECRET || \"secretkey\",\r\n-            { expiresIn: \"7d\" }\r\n-          );\r\n+//           const token = jwt.sign(\r\n+//             { id: user._id, name: user.name, email: user.email },\r\n+//             process.env.JWT_SECRET || \"secretkey\",\r\n+//             { expiresIn: \"7d\" }\r\n+//           );\r\n \r\n-          const result: UserWithToken = { user: { _id: user._id.toString(), name: user.name, email: user.email }, token };\r\n-          return done(null, result);\r\n-        } catch (err) {\r\n-          console.error(\"Google OAuth Error:\", err);\r\n-          return done(err as Error, false);\r\n-        }\r\n-      }\r\n-    )\r\n-  );\r\n-}\r\n+//           const result: UserWithToken = { user: { _id: user._id.toString(), name: user.name, email: user.email }, token };\r\n+//           return done(null, result);\r\n+//         } catch (err) {\r\n+//           console.error(\"Google OAuth Error:\", err);\r\n+//           return done(err as Error, false);\r\n+//         }\r\n+//       }\r\n+//     )\r\n+//   );\r\n+// }\r\n \r\n-/**\r\n- * JWT STRATEGY\r\n- * This will let you protect routes with `passport.authenticate(\"jwt\", { session: false })`.\r\n- * It expects JWT payload to contain { id, name, email } as created elsewhere.\r\n- */\r\n-const jwtSecret = process.env.JWT_SECRET || \"secretkey\";\r\n+// /**\r\n+//  * JWT STRATEGY\r\n+//  * This will let you protect routes with `passport.authenticate(\"jwt\", { session: false })`.\r\n+//  * It expects JWT payload to contain { id, name, email } as created elsewhere.\r\n+//  */\r\n+// const jwtSecret = process.env.JWT_SECRET || \"secretkey\";\r\n \r\n-passport.use(\r\n-  new JwtStrategy(\r\n-    {\r\n-      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\r\n-      secretOrKey: jwtSecret,\r\n-    },\r\n-    async (payload, done) => {\r\n-      try {\r\n-        // payload should contain an `id` (user id)\r\n-        if (!payload || !payload.id) {\r\n-          return done(null, false);\r\n-        }\r\n+// passport.use(\r\n+//   new JwtStrategy(\r\n+//     {\r\n+//       jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\r\n+//       secretOrKey: jwtSecret,\r\n+//     },\r\n+//     async (payload, done) => {\r\n+//       try {\r\n+//         // payload should contain an `id` (user id)\r\n+//         if (!payload || !payload.id) {\r\n+//           return done(null, false);\r\n+//         }\r\n \r\n-        // Optionally, you can fetch the user from DB to verify it still exists:\r\n-        const user = await User.findById(payload.id).select(\"_id name email\");\r\n-        if (!user) return done(null, false);\r\n+//         // Optionally, you can fetch the user from DB to verify it still exists:\r\n+//         const user = await User.findById(payload.id).select(\"_id name email\");\r\n+//         if (!user) return done(null, false);\r\n \r\n-        // attach a minimal user object to req.user\r\n-        return done(null, { id: user._id.toString(), name: user.name, email: user.email });\r\n-      } catch (err) {\r\n-        console.error(\"JWT strategy error\", err);\r\n-        return done(err as Error, false);\r\n-      }\r\n-    }\r\n-  )\r\n-);\r\n+//         // attach a minimal user object to req.user\r\n+//         return done(null, { id: user._id.toString(), name: user.name, email: user.email });\r\n+//       } catch (err) {\r\n+//         console.error(\"JWT strategy error\", err);\r\n+//         return done(err as Error, false);\r\n+//       }\r\n+//     }\r\n+//   )\r\n+// );\r\n \r\n-export default passport;\r\n+// export default passport;\r\n"
                }
            ],
            "date": 1762458197787,
            "name": "Commit-0",
            "content": "import passport from \"passport\";\r\nimport { Strategy as GoogleStrategy } from \"passport-google-oauth20\";\r\nimport { Strategy as FacebookStrategy } from \"passport-facebook\";\r\nimport { User } from \"../models/User\";\r\n\r\npassport.serializeUser((user: any, done) => {\r\n  done(null, user.id);\r\n});\r\n\r\npassport.deserializeUser(async (id, done) => {\r\n  const user = await User.findById(id);\r\n  done(null, user);\r\n});\r\n\r\n// ‚úÖ Google Strategy\r\npassport.use(\r\n  new GoogleStrategy(\r\n    {\r\n      clientID: process.env.GOOGLE_CLIENT_ID!,\r\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\r\n      callbackURL: \"http://localhost:5000/api/auth/google/callback\",\r\n    },\r\n    async (_accessToken, _refreshToken, profile, done) => {\r\n      let user = await User.findOne({ email: profile.emails?.[0].value });\r\n      if (!user) {\r\n        user = await User.create({\r\n          name: profile.displayName,\r\n          email: profile.emails?.[0].value,\r\n          password: \"google_oauth\",\r\n        });\r\n      }\r\n      return done(null, user);\r\n    }\r\n  )\r\n);\r\n\r\n// ‚úÖ Facebook Strategy\r\npassport.use(\r\n  new FacebookStrategy(\r\n    {\r\n      clientID: process.env.FACEBOOK_APP_ID!,\r\n      clientSecret: process.env.FACEBOOK_APP_SECRET!,\r\n      callbackURL: \"http://localhost:5000/api/auth/facebook/callback\",\r\n      profileFields: [\"id\", \"emails\", \"name\"],\r\n    },\r\n    async (_accessToken, _refreshToken, profile, done) => {\r\n      let email = profile.emails?.[0].value;\r\n      let user = await User.findOne({ email });\r\n      if (!user) {\r\n        user = await User.create({\r\n          name: `${profile.name?.givenName} ${profile.name?.familyName}`,\r\n          email,\r\n          password: \"facebook_oauth\",\r\n        });\r\n      }\r\n      return done(null, user);\r\n    }\r\n  )\r\n);\r\n"
        }
    ]
}